<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Pendaftaran Biznet Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #1390d0;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #1390d0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #1075b0; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-[#1390d0] dark:text-sky-400">Dashboard Pendaftaran</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Data Responden Biznet Home</p>
        </header>

        <div id="loader" class="flex flex-col items-center justify-center h-64">
            <div class="spinner"></div>
            <p class="mt-4 text-lg">Memuat data dari Google Sheets...</p>
        </div>

        <div id="dashboard-content" class="hidden">
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                    <div class="bg-sky-100 dark:bg-sky-900 p-3 rounded-full">
                        <svg class="w-8 h-8 text-[#1390d0] dark:text-sky-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962A3.375 3.375 0 0110.5 12h3c1.41 0 2.7.753 3.375 1.845m-3.375-1.845a3.375 3.375 0 00-3.375-1.845H7.5a3.375 3.375 0 00-3.375 1.845m3.375 1.845L6.106 18.72m11.894 0A9.094 9.094 0 0118 18.72a9.094 9.094 0 01-3.741.479m-7.5 0a9.094 9.094 0 00-3.741-.479M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                    <div>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">Total Responden</p>
                        <p id="total-responden" class="text-3xl font-bold">0</p>
                    </div>
                </div>
                </section>

            <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold mb-4 md:mb-0">Data Lengkap Responden</h2>
                    <input type="text" id="search-input" placeholder="Cari berdasarkan nama, NIK, atau email..." class="w-full md:w-1/3 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-[#1390d0]">
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 uppercase">
                            <tr>
                                <th class="p-4">Timestamp</th>
                                <th class="p-4">Nama Lengkap</th>
                                <th class="p-4">NIK</th>
                                <th class="p-4">No. WhatsApp</th>
                                <th class="p-4">Email</th>
                                <th class="p-4">Alamat</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                            </tbody>
                    </table>
                     <p id="no-data-message" class="text-center py-8 text-gray-500 hidden">Tidak ada data yang cocok dengan pencarian Anda.</p>
                </div>
            </section>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- KONFIGURASI PENTING ---
        // Ganti dengan URL CSV dari Google Sheet Anda yang sudah dipublikasikan
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS72Zyrvce2GBzZ3ttAotAieYlNvdMhIS4Yn6QDshilN8ad8XMXbMNO8TDuut3vAKeTzv-8ybIhlFOh/pub?gid=0&single=true&output=csv';
        // --------------------------

        const loader = document.getElementById('loader');
        const dashboardContent = document.getElementById('dashboard-content');
        const totalRespondenEl = document.getElementById('total-responden');
        const dataTableBody = document.getElementById('data-table-body');
        const searchInput = document.getElementById('search-input');
        const noDataMessage = document.getElementById('no-data-message');
        let allData = []; // Simpan semua data untuk pencarian

        if (GOOGLE_SHEET_URL === 'PASTE_URL_CSV_ANDA_DI_SINI' || !GOOGLE_SHEET_URL) {
            loader.innerHTML = '<p class="text-red-500 text-lg">Error: URL Google Sheet belum diatur. Edit file dashboard.html dan masukkan URL CSV Anda.</p>';
            return;
        }

        // Fungsi untuk mengambil dan mem-parsing data
        function fetchData() {
            Papa.parse(GOOGLE_SHEET_URL, {
                download: true,
                header: true, // Menggunakan baris pertama sebagai header
                complete: (results) => {
                    // Balik urutan data agar yang terbaru di atas
                    allData = results.data.reverse(); 
                    displayData(allData);
                    updateStatistics(allData);
                    
                    loader.style.display = 'none';
                    dashboardContent.classList.remove('hidden');
                },
                error: (err) => {
                    console.error("Error fetching data: ", err);
                    loader.innerHTML = '<p class="text-red-500 text-lg">Gagal memuat data. Periksa kembali URL atau pengaturan publikasi Google Sheet Anda.</p>';
                }
            });
        }
        
        // Fungsi untuk menampilkan data ke tabel
        function displayData(data) {
            dataTableBody.innerHTML = ''; // Kosongkan tabel sebelum mengisi
            if (data.length === 0) {
                 noDataMessage.classList.remove('hidden');
            } else {
                 noDataMessage.classList.add('hidden');
            }

            data.forEach(row => {
                // Pastikan kolom yang Anda gunakan sesuai dengan header di Google Sheet
                // Misalnya: 'Timestamp', 'Nama Lengkap', 'NIK', dst.
                // Sesuaikan nama properti di bawah ini (row['Nama Kolom']) jika berbeda.
                // Kode dari formulir Anda mengirim `nama`, `nik`, dll. tapi Google Form otomatis menambahkan `Timestamp`.
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                tr.innerHTML = `
                    <td class="p-4 whitespace-nowrap">${row['Timestamp'] || 'N/A'}</td>
                    <td class="p-4 font-medium">${row['nama'] || 'N/A'}</td>
                    <td class="p-4">${row['nik'] || 'N/A'}</td>
                    <td class="p-4">${row['whatsapp'] || 'N/A'}</td>
                    <td class="p-4">${row['email'] || 'N/A'}</td>
                    <td class="p-4 max-w-xs truncate" title="${row['alamat'] || ''}">${row['alamat'] || 'N/A'}</td>
                `;
                dataTableBody.appendChild(tr);
            });
        }

        // Fungsi untuk mengupdate statistik
        function updateStatistics(data) {
            totalRespondenEl.textContent = data.length;
        }

        // Event listener untuk input pencarian
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = allData.filter(row => {
                return (row['nama'] && row['nama'].toLowerCase().includes(searchTerm)) ||
                       (row['nik'] && row['nik'].toLowerCase().includes(searchTerm)) ||
                       (row['email'] && row['email'].toLowerCase().includes(searchTerm));
            });
            displayData(filteredData);
        });

        // Mulai ambil data
        fetchData();
    });
    </script>
</body>
</html>
